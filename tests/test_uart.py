from bellows.uart import Gateway


def test_randomize():
    gw = Gateway(None)
    assert gw._randomize(b'\x00\x00\x00\x00\x00') == b'\x42\x21\xa8\x54\x2a'
    assert gw._randomize(b'\x42\x21\xa8\x54\x2a') == b'\x00\x00\x00\x00\x00'


def test_stuff():
    gw = Gateway(None)
    orig = b'\x00\x7E\x01\x7D\x02\x11\x03\x13\x04\x18\x05\x1a\x06'
    stuff = b'\x00\x7D\x5E\x01\x7D\x5D\x02\x7D\x31\x03\x7D\x33\x04\x7D\x38\x05\x7D\x3a\x06'
    assert gw._stuff(orig) == stuff


def test_unstuff():
    gw = Gateway(None)
    orig = b'\x00\x7E\x01\x7D\x02\x11\x03\x13\x04\x18\x05\x1a\x06'
    stuff = b'\x00\x7D\x5E\x01\x7D\x5D\x02\x7D\x31\x03\x7D\x33\x04\x7D\x38\x05\x7D\x3a\x06'
    assert gw._unstuff(stuff) == orig


def test_rst():
    gw = Gateway(None)
    assert gw._rst_frame() == b'\x1a\xc0\x38\xbc\x7e'
